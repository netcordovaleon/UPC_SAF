@model SAF.Web.Intranet.Models.PropuestaModel
@{
    ViewBag.PageTitle = "Propuesta";
    ViewBag.PageDescription = "Propuestas";
    ViewBag.PageDescription = "Bandeja Calificacion de Propuestas";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="callout callout-info">
    <h4><i class="icon fa fa-info"></i>&nbsp;Información</h4>
    <p>
        El sistema propondra a la propuesta que cuente con el equipo mas calificado, pero el usuario final determinara finalmente al ganador.
    </p>
</div>


<div class="row">
    <div class="col-md-12">
        <div class="box box-primary color-palette-box">
            <div class="box-header with-border">
                <h3 class="box-title">Listado de Propuestas por Calificar</h3>
            </div>
            <div class="box-body">


                <div class="form-group">
                    <div class="row">
                        <div class="col-md-6">
                            @Html.LabelFor(c=>c.CODPUB)
                            @Html.DropDownListFor(c => c.CODPUB, Model.cboPublicaciones, "Seleccione", new { @class = "form-control" })
                        </div>
                        <div class="col-md-3">
                            <br />
                            <button id="btnBuscarPropuestas" class="btn btn-primary"><i class="fa fa-search"></i>&nbsp;Buscar</button>
                        </div>
                    </div>
                </div>


                <div class="form-group">
                    <div class="row">
                        <div class="col-md-12">
                            <table id="tabPropuestas" class="table table-striped table-bordered" cellpadding="0" cellspacing="0" border="0"></table>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <div class="row">
                        <div class="col-md-12">
                            <button type="button" id="btnDefinirGanador" class="btn btn-success"><i class="fa fa-check"></i>&nbsp;Definir Ganador</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section scripts {

    <script type="text/javascript" language="javascript">


        var _dataPropuestas_ = null;
        var tabPropuestas = $("#tabPropuestas").dataTable({
            "info": false,
            "bServerSide": false,
            "data": _dataPropuestas_,
            "order": [[1, "asc"]],
            "columns": [
                {
                    "bSortable": false,
                    "sClass": "center",
                    "sWidth": "5%",
                    "render": function (data, type, row) {
                        return '<center><button class="btn btn-primary" title="Informacion Propuesta" type="button" onclick="verInformacionPropuesta(' + row[0] + ');"><i class="fa fa-file-pdf-o"></i></button></center>';
                    }
                },
                {
                    "sTitle": "Sociedad",
                    "render": function (data, type, row) {
                        return "<div style='font-size:13px;'><i>RUC - Razon Social:</i> <br/>" + data + "</div>";
                    }
                },
                { "sTitle": "Representante", "sWidth": "15%" },
                { "sTitle": "Cel. Representate", "visible": false },
                { "sTitle": "Correo Representate", "visible": false },
                { "sTitle": "Entidad" },
                { "sTitle": "Retribucion" },
                { "sTitle": "IGV" },
                { "sTitle": "Puntaje", "sClass": "center" },
                {
                    "sTitle": "Ganador",
                    "render": function (data, type, row) {
                        return "<center><input type='radio' value = '" + row[0] + "' name='rdGanadorPropuesta' /></center>";
                    }
                },
            ]
        });


        $(document).ready(function () {
            listarPropuestas();
            $("#btnBuscarPropuestas").click(listarPropuestas);
        });

        function listarPropuestas() {
            $.ajax({
                url: '@Url.Action("ListadoPropuestasCalificar", "Propuesta")',
                type: 'POST',
                async: false,
                data: { idPub: $("#CODPUB").val() },
                success: function (result) {
                    _dataPropuestas_ = result;
                    tabPropuestas.fnReloadData(_dataPropuestas_);
                }
            });
        }



    </script>

}